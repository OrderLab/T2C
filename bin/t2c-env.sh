#!/usr/bin/env bash
#
# @author Ryan Huang <huang@cs.jhu.edu>
#
# The T2C Project
#
# Copyright (c) 2018, Johns Hopkins University - Order Lab.
#     All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Setup the environment variables necessary for T2C to run. It should NOT be
# run directly but instead should be sourced by the main T2C script.

cur_dir=$(dirname "${BASH_SOURCE-$0}")
cur_dir="$(cd "${cur_dir}"; pwd)"

# We prefer java from the JAVA_HOME
if [[ -z "$JAVA_HOME" ]]; then
  JAVA="$JAVA_HOME/bin/java"
else
  if [[ -z "$(which java)" ]]; then
    echo "java command not found"
    exit 1
  fi
  JAVA=java
  # when JAVA_HOME is not set, we will set it
  JAVA_HOME=${JAVA_HOME:-"$(dirname $(which java))/.."}
fi

VERSION=1.0-SNAPSHOT
T2C_HOME=$(dirname "${cur_dir}")
T2C_JAR="${T2C_HOME}/target/t2c-${VERSION}-jar-with-dependencies.jar"
# generated by: cd ~/.m2/repository/org/soot-oss/soot/4.1.0 && mvn assembly:single -DdescriptorId=jar-with-dependencies -f soot-4.1.0.pom
SOOT_JAR="${T2C_HOME}/lib/sootclasses-trunk-jar-with-dependencies.jar:${T2C_HOME}/lib/soot-4.3.0.jar"
T2C_MAIN=edu.jhu.order.t2c.staticd.T2CMain

T2C_CONF_DIR="${T2C_CONF_DIR:-${T2C_HOME}/conf}"
T2C_LOGS_DIR="${T2C_LOGS_DIR:-${T2C_HOME}/logs}"

T2C_JAVA_OPTS+=" -Dt2c.conf.dir=${T2C_CONF_DIR} -Dt2c.logs.dir=${T2C_LOGS_DIR}"
T2C_JAVA_OPTS+=" -Dlog4j.configuration=file:${T2C_CONF_DIR}/log4j.properties"

T2C_CLASSPATH="${T2C_CONF_DIR}:${T2C_JAR}:${SOOT_JAR}"

# classpaths that Soot needs to know.
if [[ -z "$SOOT_CLASSPATPH" ]]; then
  SOOT_CLASSPATPH="${T2C_HOME}/lib/objenesis-2.6.jar:${T2C_HOME}/lib/cloning-1.9.9.jar"
fi
